{"remainingRequest":"C:\\Users\\NETDB\\expert2\\expert_web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\NETDB\\expert2\\expert_web\\src\\components\\History.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"C:\\Users\\NETDB\\expert2\\expert_web\\src\\components\\History.vue","mtime":1646199605942},{"path":"C:\\Users\\NETDB\\expert2\\expert_web\\node_modules\\css-loader\\dist\\cjs.js","mtime":1646199721271},{"path":"C:\\Users\\NETDB\\expert2\\expert_web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1646199725603},{"path":"C:\\Users\\NETDB\\expert2\\expert_web\\node_modules\\postcss-loader\\src\\index.js","mtime":1646199723268},{"path":"C:\\Users\\NETDB\\expert2\\expert_web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1646199720093},{"path":"C:\\Users\\NETDB\\expert2\\expert_web\\node_modules\\vue-loader\\lib\\index.js","mtime":1646199724004}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLmlkZW50aWNhbCB7DQogIHdpZHRoIDogMTAwcHg7DQogIGp1c3RpZnktY29udGVudCA6IGNlbnRlciAhaW1wb3J0YW50Ow0KDQp9DQoNCg0K"},{"version":3,"sources":["History.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8eA;AACA;AACA;;AAEA","file":"History.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n\r\n  <v-container >\r\n\r\n\r\n    <template class=\"md-12\">\r\n      <v-layout>\r\n    <!-- <v-row >\r\n      <v-col cols=\"1\" > -->\r\n      <v-flex md1>\r\n        <p class=\"text-left font-weight-bold text-h5\" >\r\n          {{ltext}}\r\n        </p>\r\n        </v-flex>\r\n\r\n      <!-- </v-col> -->\r\n    <!-- </v-row> -->\r\n      <!-- <v-col  cols=\"11\" class=\"\" justify-end> -->\r\n      <v-flex md11 justify-end  row wrap class=\"mt-1 mb-1\">\r\n      <v-btn icon color=\"grey \" class=\"mr-2\" @click=\"refreshHistories()\">\r\n        <v-icon>refresh</v-icon>\r\n      </v-btn>\r\n      <v-btn color=\"grey lighten-2\" class=\"mr-3 mb-2\" @click=\"exapndAll()\">\r\n        {{expandString}}\r\n      </v-btn>\r\n        </v-flex>\r\n      <!-- </v-col> -->\r\n\r\n    <!-- </v-row> -->\r\n    </v-layout>\r\n  </template>\r\n\r\n    <!-- :options.sync=\"options\" -->\r\n    <v-data-table\r\n        :headers=\"headers\"\r\n        :items=\"getHistories\"\r\n        :itemsPerPage=\"ipg\"\r\n        :expanded.sync=\"expanded\"\r\n        :page=\"page\"\r\n        item-key=\"_id\"\r\n        show-expand\r\n        class=\"elevation-1\"\r\n      >\r\n    <template v-slot:item.year=\"{ item }\">\r\n        {{ new Date(item.query_time).getFullYear()-item.year }} ~ {{ new Date(item.query_time).getFullYear() }}\r\n     </template>\r\n  <template v-slot:item.state=\"{ item }\" >\r\n       <v-chip  class=\"identical pa-2\" :color=\"statusColor[item.state]\" v-html=\"statusLabel[item.state]\" dark></v-chip>\r\n   </template>\r\n\r\n  <template v-slot:expanded-item=\"{ headers, item}\">\r\n\r\n    <td :colspan=\"headers.length\" >\r\n    <!-- {{item._id}} -->\r\n    <v-data-table\r\n        :headers=\"headers2\"\r\n        :items=\"item.sites\"\r\n        hide-default-footer\r\n        class=\"elevation-1 ma-2\"\r\n      >\r\n      <template v-slot:item.site=\"{ item }\">\r\n           {{item.site}}{{getFilterString(item.site, item.filter)}}\r\n       </template>\r\n      <template v-slot:item.data=\"{ item }\">\r\n           {{item.data}}{{getPartialString(item.isPartial)}}\r\n       </template>\r\n\r\n      <template v-slot:item.state=\"{ item }\">\r\n           <v-chip class=\"identical pa-2\" :color=\"statusColor[item.state]\" v-html=\"statusLabel[item.state]\" dark></v-chip>\r\n       </template>\r\n\r\n       <template v-slot:item.removeaction=\"{ item }\">\r\n         <v-icon\r\n          @click=\"editHistory(item)\" v-show=\"item.site != 'ALL'\"\r\n         >{{  mdiDatabaseEdit    }}</v-icon>\r\n          <v-icon color=\"red\"\r\n           @click=\"removeHistory(item._id, item.site)\"\r\n          >{{  mdiDelete    }}</v-icon>\r\n\r\n        </template>\r\n        <template v-slot:item.data=\"{ item }\">\r\n          {{transformLocale(item.data)}}\r\n        </template>\r\n        <template v-slot:item.experts=\"{ item }\">\r\n          {{transformLocale(item.experts)}}\r\n        </template>\r\n\r\n    </v-data-table>\r\n    </td>\r\n  </template>\r\n\r\n\r\n  <template v-slot:item.actions=\"{ item }\">\r\n     <v-icon v-show=\"isShow(item.sites)\"\r\n      @click=\"getDetailHistory(item._id, getHistories.indexOf(item), item.sites[0].progress)\"\r\n     >{{  mdiChevronRightCircle  }}</v-icon>\r\n   </template>\r\n\r\n   <template v-slot:item.integration=\"{ item }\">\r\n      <v-icon v-show=\"isShow(item.sites)\"\r\n       @click=\"goIntegrationPage(item._id, item.query_keyword, item)\"\r\n      >{{  mdiChevronRightCircle  }}</v-icon>\r\n    </template>\r\n\r\n\r\n   <template v-slot:item.removeaction=\"{ item }\">\r\n      <v-icon v-show=\"isShow(item.sites)\" color=\"red\"\r\n       @click=\"removeHistory(item._id, 'ALL')\"\r\n      >{{  mdiDelete    }}</v-icon>\r\n    </template>\r\n\r\n</v-data-table>\r\n\r\n<v-dialog\r\n         v-model=\"dialog\"\r\n         max-width=\"500px\"\r\n       >\r\n         <v-card>\r\n           <v-card-title>\r\n             <span class=\"text-h5\">Site : {{editedItem.site}} (keyID : {{editedItem._id}}) </span>\r\n           </v-card-title>\r\n\r\n           <v-card-text>\r\n             <v-container>\r\n               <v-row>\r\n                 <v-col\r\n                   cols=\"12\"\r\n                   sm=\"6\"\r\n                   md=\"4\"\r\n                 >\r\n                   <v-text-field\r\n                     v-model=\"editedItem.state\"\r\n                     label=\"State\"\r\n                   ></v-text-field>\r\n                 </v-col>\r\n                 <v-col\r\n                   cols=\"12\"\r\n                   sm=\"6\"\r\n                   md=\"4\"\r\n                 >\r\n                   <v-text-field\r\n                     v-model=\"editedItem.progress\"\r\n                     label=\"Progress\"\r\n                   ></v-text-field>\r\n                 </v-col>\r\n\r\n               </v-row>\r\n             </v-container>\r\n           </v-card-text>\r\n\r\n           <v-card-actions>\r\n             <v-spacer></v-spacer>\r\n             <v-btn\r\n               color=\"blue darken-1\"\r\n               text\r\n               @click=\"close\"\r\n             >\r\n               Cancel\r\n             </v-btn>\r\n             <v-btn\r\n               color=\"blue darken-1\"\r\n               text\r\n               @click=\"save\"\r\n             >\r\n               Save\r\n             </v-btn>\r\n           </v-card-actions>\r\n         </v-card>\r\n       </v-dialog>\r\n\r\n\r\n  </v-container>\r\n\r\n</template>\r\n<script>\r\nimport {  mdiChevronRightCircle , mdiDelete , mdiDatabaseEdit  } from '@mdi/js';\r\nimport Vue from 'vue'\r\n  export default {\r\n    data() {\r\n      return {\r\n        statusLabel : { '0' : 'Crawling', '1': 'Analyzing', '2' : 'Completed', '-1' : \"Crawling Failed\", '-2' : \"Consumer Failed\" , '-3' : \"API Limit\"},\r\n        statusColor : { '0' : 'red', '1' : 'orange', '2' : 'green', '-1' : 'blue', '-2' : '#7676a7', '-3' : 'black'},\r\n        expandString : 'Expand All',\r\n        isExpandAll : false,\r\n        dialog : false,\r\n        mdiChevronRightCircle  :  mdiChevronRightCircle ,\r\n        mdiDelete   : mdiDelete ,\r\n        mdiDatabaseEdit : mdiDatabaseEdit ,\r\n        expanded: [],\r\n        options : {},\r\n        editedItem: {\r\n          _id : -1,\r\n          site: '',\r\n          state: 0,\r\n          progress: 0,\r\n        },\r\n        // page: 1,\r\n        headers: [\r\n          {\r\n            text: 'KeyID',\r\n            align: 'start',\r\n            sortable: false,\r\n            value: '_id',\r\n          },\r\n         {\r\n           text: '검색어',\r\n           align: 'start',\r\n           sortable: false,\r\n           value: 'query_keyword',\r\n         },\r\n         { text: '검색 시간', value: 'query_time' },\r\n         { text: '진행 상태', value: 'state' },\r\n         { text: '논문 검색 연도', value: 'year', sortable: false , align: 'center' },\r\n         { text: '상세 보기', value: 'actions',sortable: false , align: 'center' },\r\n          { text: '통합 결과', value: 'integration',sortable: false , align: 'center' },\r\n\r\n       ],\r\n       headers2: [\r\n         {\r\n           text: '사이트명',\r\n           align: 'start',\r\n           sortable: false,\r\n           value: 'site',\r\n         },\r\n         {\r\n           text: '진행률',\r\n           align: 'start',\r\n           sortable: false,\r\n           value: 'progress',\r\n         },\r\n         {\r\n           text: '진행 상태',\r\n           align: 'start',\r\n           sortable: false,\r\n           value: 'state',\r\n         },\r\n        {\r\n          text: '수집 시간',\r\n          align: 'start',\r\n          sortable: false,\r\n          value: 'crawl_time',\r\n        },\r\n        {\r\n          text: '수집량',\r\n          align: 'start',\r\n          sortable: false,\r\n          value: 'data',\r\n        },  {\r\n            text: '분석 시간',\r\n            align: 'start',\r\n            sortable: false,\r\n            value: 'a_time',\r\n          },  {\r\n              text: '분석량',\r\n              align: 'start',\r\n              sortable: false,\r\n              value: 'experts',\r\n            },\r\n\r\n      ],\r\n        itemsPerPageArray: [4, 8, 12]\r\n        // filterStr : { : '(ALL)' ,  false : '(Korea)'}\r\n        // page: 1,\r\n\r\n\r\n      }\r\n    },\r\n\r\n    beforeDestroy() {\r\n      window.removeEventListener('keyup', this.handler);\r\n    },\r\n    watch: {\r\n      options: {\r\n        handler(){\r\n\r\n          //console.log('THIS.PAGE', this.page);\r\n          //console.log('THIS.OPTIONS.PAGE', this.options.page);\r\n          this.page = this.options.page;\r\n        },\r\n        deep: true\r\n      }\r\n    },\r\n    props : ['lgSize', 'itemsPerPage', 'page', 'ltext'],\r\n    created(){\r\n      this.$store.dispatch('getHistories');\r\n      const component = this;\r\n      const tempHeader = component.headers;\r\n      const tempHeader2 = component.headers2;\r\n\r\n      // this.initialize()\r\n      this.handler = function (e) {\r\n        component.$emit('keyup', e);\r\n\r\n        if (e.which === 115) {\r\n          component.ok = !component.ok;\r\n          if (component.ok){\r\n            // component.headers = component.headers.slice(0, 4)\r\n            tempHeader.push({ text: 'Actions', value: 'removeaction', sortable: false });\r\n            tempHeader2.push({ text: 'Actions', value: 'removeaction', sortable: false });\r\n            // tempHeader2.push({ text: '수정', value: 'editaction', sortable: false });\r\n\r\n          }else {\r\n            // component.headers.push({ text: 'Actions', value: 'actions', sortable: false })\r\n            tempHeader.splice(7, 1);\r\n            tempHeader2.splice(7, 1);\r\n\r\n          }\r\n        }\r\n      }\r\n      window.addEventListener('keyup', this.handler);\r\n\r\n    },\r\n    computed: {\r\n      getHistories() {\r\n        return this.$store.state.histories;\r\n      },\r\n      numberOfPages() {\r\n        return Math.ceil(this.getHistories.length / this.itemsPerPage);\r\n      },\r\n      ipg(){\r\n        return this.itemsPerPage;\r\n      }\r\n    },\r\n    methods: {\r\n\r\n      transformLocale(v){\r\n        // v.experts\r\n        if (v !== undefined)\r\n          return v.toLocaleString(\"kr-KR\");\r\n          // console.log('V.EXPERTS', v);\r\n        return \"\";\r\n        // return parseInt(v.experts).toLocalString(\"kr-KR\")\r\n      },\r\n      goIntegrationPage(id, query_keyword, item){\r\n        console.log('ITEM', item);\r\n\r\n        // this.$store.dispatch('getIntegrationData', {'id' : id, 'query_keyword' : query_keyword, 'sites' : item.sites});\r\n        this.$store.dispatch('getIntegrationData', {'id' : id, 'query_keyword' : query_keyword});\r\n        this.$router.push({name: 'integration'});\r\n\r\n      },\r\n      close(){\r\n        this.dialog = false;\r\n      },\r\n      save(){\r\n        this.dialog = false;\r\n\r\n        this.$store.dispatch('editHistory', this.editedItem).then(() =>{\r\n          // console.log(res);\r\n          this.refreshHistories();\r\n          // console.log(\"y\");\r\n        });\r\n        // console.log('ITEM', this.editedItem);\r\n      },\r\n\r\n      editHistory(item){\r\n        // console.log('ITEM', item);\r\n        this.editedItem = Object.assign({}, item);\r\n        this.dialog = true;\r\n\r\n      },\r\n      removeHistory(_id, _site){\r\n        // console.log(_id, _site);\r\n        // console.log();\r\n        if (confirm(\"Are you sure?\") == true){\r\n          if (this.getHistories[this.getHistories.findIndex(x=> x._id == _id)].sites.length == 2){\r\n            _site = 'ALL';\r\n          }\r\n          // console.log(_id, _site);\r\n          this.$store.dispatch('removeHistory',{'keyId': _id, 'site' : _site}).then(() =>{\r\n            // console.log(res);\r\n            this.refreshHistories();\r\n            // console.log(\"y\");\r\n          });\r\n\r\n\r\n        }\r\n\r\n      },\r\n      getFilterString(site, flag){\r\n        if(site == 'WOS' || site == 'SCOPUS')\r\n          if(flag)\r\n            return \"(ALL)\";\r\n          else\r\n            return \"(Korea)\";\r\n\r\n        return \"\";\r\n      },\r\n      getPartialString (flag){\r\n        if(flag !== 'undefined' && flag)\r\n        {\r\n          return \"(Partial Crawled)\";\r\n        }\r\n      },\r\n      getDetailHistory(id, _idx, all_pro){\r\n        // console.log('IT', it);\r\n        // console.log(this.options);\r\n        // this.options.page = 5;\r\n        let idx = this.$store.state.tabs.findIndex(x=> x._id === id);\r\n        // console.log('THIS.$STORE.STATE.TABS', this.$store.state.tabs);\r\n\r\n        if(idx == -1){\r\n          this.$emit('tabInit');\r\n          this.$store.dispatch('getDetailHistory', {'id' : id});\r\n          //reuse code\r\n          if(this.lgSize != 6){\r\n            // console.log('_IDX', Math.ceil(_idx/5));\r\n            this.$router.push({name: 'result', params : {page:Math.ceil(_idx / 5)}});\r\n          }\r\n        }\r\n        else{\r\n          if(this.$store.state.tabs[idx].sites[0].progress != all_pro){\r\n\r\n            Vue.delete(this.$store.state.tabs, idx);\r\n            this.$emit('tabInit');\r\n            this.$store.dispatch('getDetailHistory', {'id' : id});\r\n          }\r\n          else{\r\n            this.$store.state.activeTab = idx;\r\n          }\r\n\r\n          if(this.lgSize != 6){\r\n            // console.log('_IDX', Math.ceil(_idx/5));\r\n            this.$router.push({name: 'result', params :  {page:Math.ceil(_idx / 5)}});\r\n          }\r\n        }\r\n        this.$emit('tabScroll');\r\n      },\r\n      refreshHistories() {\r\n        this.$store.dispatch('getHistories', 0)\r\n      },\r\n      //remove code\r\n      getStatusColor(state) {\r\n\r\n        switch (state) {\r\n          case 0:\r\n            return 'red'\r\n          case 1:\r\n            return 'orange'\r\n          case 2:\r\n            return 'green'\r\n          }\r\n      },\r\n       //remove code\r\n      getColor(pcnt) {\r\n        if (pcnt >= 100) return 'green'\r\n        else if (pcnt > 50) return 'orange'\r\n\r\n        return 'red'\r\n      },\r\n      //remove code\r\n      getStatus(status) {\r\n        switch (status) {\r\n          case 0:\r\n            return 'Crawling '\r\n          case 1:\r\n            return 'Analyzing '\r\n          case 2:\r\n            return 'Completed'\r\n          // case 3:\r\n          //   return 'Stopped'\r\n          // case 4:\r\n          //   return 'Completed'\r\n        }\r\n      },\r\n      isShow(sites){\r\n        if( sites.findIndex(x=>x.state==2) == -1)\r\n          return false;\r\n        else\r\n          return true;\r\n\r\n      },\r\n      exapndAll(){\r\n        let tempString = \"\";\r\n        if(this.isExpandAll){\r\n          this.expanded = [];\r\n          tempString = \"Expand All\";\r\n        }\r\n        else{\r\n          this.expanded =this.$store.state.histories;\r\n          tempString = \"Collapse All\";\r\n        }\r\n\r\n        this.expandString = tempString;\r\n        this.isExpandAll = !this.isExpandAll;\r\n        // this.exapanded.push(this.$store.state.histories[0])\r\n        // this.$set(this.exapaned, this.$store.state.histories)\r\n        // this.exapaned = this.$store.state.histories)\r\n      }\r\n    }\r\n  }\r\n\r\n</script>\r\n<style>\r\n.identical {\r\n  width : 100px;\r\n  justify-content : center !important;\r\n\r\n}\r\n\r\n\r\n</style>\r\n"]}]}